- if !current_user.in_role? :auditor or @site_report.status == 2
  :javascript
    $(function() {
      $("input.updatable").keyup(function() {
        $(".buttons input").attr("disabled", "disabled");
        // check if integer
        if (Number(this.value) != this.value) {
        //  alert("Not integer");
        //  return;
        }
        var dirty = false;
        $("input.updatable").each(function() {
          if ($(this).attr("ovalue") != $(this).attr("value")) {
            dirty = true;
            return false;
          }
        });
        if (dirty)
          $(".buttons input").removeAttr("disabled");
        else
          $(".buttons input").attr("disabled", "disabled");
      });
    });

#wrapper
  #report
    %h1.page_title= "統聯酒測日報表 - #{@site_name} - #{@date}"
    - if @errors and @errors.size
      .errors
        - @errors.each do |k,v|
          #{v} <br/>
    %form{:action => "/site/#{@site_name}/#{@date}", :method => "post"}
      .field
        %label{:for => "status"} 狀態
        %input{:id => "status", :name => "status", :size => 30, :type => "text",
          :value => @status_text, :disabled => "disabled"}
        %input{:name => "status", :type => "hidden", :value => @status_text}
      .field
        %label{:for => "total_tests"} 受測總次數
        %input{:id => "total_tests", :name => "site_report[total_tests]", :size => 30, :type => "text",
               :value => @site_report.total_tests, :disabled => "disabled"}
        %input{:name => "site_report[total_tests]", :type => "hidden", :value => @site_report.total_tests}
      .field
        %label{:for => "anomaly_tests"} 異常次數
        %input{:id => "anomaly_tests", :name => "site_report[anomaly_tests]", :size => 30, :type => "text",
               :value => @site_report.anomaly_tests, :disabled => "disabled"}
        %input{:name => "site_report[anomaly_tests]", :type => "hidden", :value => @site_report.anomaly_tests}
      - [{:id => "total_trips", :value => @site_report.total_trips, :label => "總班次數"},
         {:id => "operator_tests", :value => @site_report.operator_tests, :label => "調度測試"},
         {:id => "trainees", :value => @site_report.trainees, :label => "見習"},
         {:id => "pumpings", :value => @site_report.pumpings, :label => "抽班"},
         {:id => "repeats", :value => @site_report.repeats, :label => "重覆"}].each do |f|
        .field
          %label{:for => f[:id]}= f[:label]
          %input.updatable{:id => f[:id], :name => "site_report[#{f[:id]}]", :size => 30, :type => "text",
            :value => f[:value], :ovalue => f[:value]}
      .field
        %label{:for => "inputter"} 登錄人姓名
        %input{:id => "inputter_name", :name => "site_report[inputter_name]", :size => 30, :type => "text",
               :value => @site_report.inputter_name, :disabled => "disabled"}
      .field
        %label{:for => "auditor_name"} 主管姓名
        %input{:id => "auditor_name", :name => "site_report[auditor_name]", :size => 30, :type => "text",
               :value => @site_report.auditor_name, :disabled => "disabled"}
      %br
        .buttons
          - if !current_user.in_role? :auditor or @site_report.status == 2
            %input{ :value => "更新", :type => "submit", :disabled => "disabled"}
          - else
            %input{ :value => "核覆", :type => "submit"}
#navigation
  %nav
    %ul
      - @available_dates.each do |d|
        %li
          %a{:href => "/site/#{@site_name}/#{d}", :class => d == @date.to_s && "selected"}= d            
